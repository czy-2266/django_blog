{"ast":null,"code":"import { defineStore } from 'pinia';\nimport { authAPI } from '../api/auth';\nexport const useAuthStore = defineStore('auth', {\n  state: () => ({\n    user: null,\n    token: localStorage.getItem('token'),\n    isLoading: false,\n    error: null\n  }),\n  getters: {\n    isAuthenticated: state => !!state.token && !!state.user,\n    isLoggedIn: state => !!state.token\n  },\n  actions: {\n    // 登录\n    async login(credentials) {\n      this.isLoading = true;\n      this.error = null;\n      try {\n        const response = await authAPI.login(credentials);\n        this.token = response.token; // Django返回的是token字段，不是access_token\n        localStorage.setItem('token', this.token);\n\n        // 获取用户信息\n        await this.fetchCurrentUser();\n        return {\n          success: true\n        };\n      } catch (error) {\n        this.error = error.response?.data?.detail || error.response?.data?.error || '登录失败';\n        return {\n          success: false,\n          error: this.error\n        };\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    // 注册\n    async register(userData) {\n      this.isLoading = true;\n      this.error = null;\n      try {\n        // userdata:{username,password,email}\n        const response = await authAPI.register(userData);\n        return {\n          success: true,\n          data: response\n        };\n      } catch (error) {\n        console.log(error.response?.data?.detail || '注册失败');\n        this.error = error.response?.data?.detail || '注册失败';\n        return {\n          success: false,\n          error: this.error\n        };\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    // 获取当前用户信息\n    async fetchCurrentUser() {\n      if (!this.token) return;\n      try {\n        this.user = await authAPI.getCurrentUser();\n      } catch (error) {\n        console.error('获取用户信息失败:', error);\n        this.logout();\n      }\n    },\n    // 更新用户信息\n    async updateUser(userData) {\n      this.isLoading = true;\n      this.error = null;\n      try {\n        this.user = await authAPI.updateUser(userData);\n        return {\n          success: true\n        };\n      } catch (error) {\n        this.error = error.response?.data?.detail || '更新失败';\n        return {\n          success: false,\n          error: this.error\n        };\n      } finally {\n        this.isLoading = false;\n      }\n    },\n    // 登出\n    logout() {\n      authAPI.logout();\n      this.user = null;\n      this.token = null;\n      this.error = null;\n    },\n    // 清除错误\n    clearError() {\n      this.error = null;\n    },\n    // 初始化认证状态\n    async initAuth() {\n      if (this.token && !this.user) {\n        await this.fetchCurrentUser();\n      }\n    }\n  }\n});","map":{"version":3,"names":["defineStore","authAPI","useAuthStore","state","user","token","localStorage","getItem","isLoading","error","getters","isAuthenticated","isLoggedIn","actions","login","credentials","response","setItem","fetchCurrentUser","success","data","detail","register","userData","console","log","getCurrentUser","logout","updateUser","clearError","initAuth"],"sources":["/Users/a123/PythonProject/System/django_blog/frontend/src/stores/auth.js"],"sourcesContent":["import { defineStore } from 'pinia';\r\nimport { authAPI } from '../api/auth';\r\n\r\nexport const useAuthStore = defineStore('auth', {\r\n  state: () => ({\r\n    user: null,\r\n    token: localStorage.getItem('token'),\r\n    isLoading: false,\r\n    error: null,\r\n  }),\r\n\r\n  getters: {\r\n    isAuthenticated: (state) => !!state.token && !!state.user,\r\n    isLoggedIn: (state) => !!state.token,\r\n  },\r\n\r\n  actions: {\r\n    // 登录\r\n    async login(credentials) {\r\n      this.isLoading = true;\r\n      this.error = null;\r\n      \r\n      try {\r\n        const response = await authAPI.login(credentials);\r\n        this.token = response.token;  // Django返回的是token字段，不是access_token\r\n        localStorage.setItem('token', this.token);\r\n        \r\n        // 获取用户信息\r\n        await this.fetchCurrentUser();\r\n        \r\n        return { success: true };\r\n      } catch (error) {\r\n        this.error = error.response?.data?.detail || error.response?.data?.error || '登录失败';\r\n        return { success: false, error: this.error };\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n\r\n    // 注册\r\n    async register(userData) {\r\n      this.isLoading = true;\r\n      this.error = null;\r\n      \r\n      try {\r\n        // userdata:{username,password,email}\r\n        const response = await authAPI.register(userData);\r\n        return { success: true, data: response };\r\n      } catch (error) {\r\n        console.log(error.response?.data?.detail || '注册失败')\r\n        this.error = error.response?.data?.detail || '注册失败';\r\n        return { success: false, error: this.error };\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n\r\n    // 获取当前用户信息\r\n    async fetchCurrentUser() {\r\n      if (!this.token) return;\r\n      \r\n      try {\r\n        this.user = await authAPI.getCurrentUser();\r\n      } catch (error) {\r\n        console.error('获取用户信息失败:', error);\r\n        this.logout();\r\n      }\r\n    },\r\n\r\n    // 更新用户信息\r\n    async updateUser(userData) {\r\n      this.isLoading = true;\r\n      this.error = null;\r\n      \r\n      try {\r\n        this.user = await authAPI.updateUser(userData);\r\n        return { success: true };\r\n      } catch (error) {\r\n        this.error = error.response?.data?.detail || '更新失败';\r\n        return { success: false, error: this.error };\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n\r\n    // 登出\r\n    logout() {\r\n      authAPI.logout();\r\n      this.user = null;\r\n      this.token = null;\r\n      this.error = null;\r\n    },\r\n\r\n    // 清除错误\r\n    clearError() {\r\n      this.error = null;\r\n    },\r\n\r\n    // 初始化认证状态\r\n    async initAuth() {\r\n      if (this.token && !this.user) {\r\n        await this.fetchCurrentUser();\r\n      }\r\n    },\r\n  },\r\n});"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}